<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SkenovÃ¡nÃ­ QR / ÄŒÃ¡rovÃ©ho kÃ³du</title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- ZXing knihovna -->
  <script src="https://unpkg.com/@zxing/browser@0.1.5"></script>

  <style>
    #video {
      width: 100%;
      max-width: 640px;
      height: auto;
      border: 3px solid #198754;
      border-radius: 1rem;
      background: black;
    }
    #status { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">ğŸ“· SkenovÃ¡nÃ­ QR / ÄŒÃ¡rovÃ©ho kÃ³du</h1>

    <div class="row justify-content-center">
      <div class="col-md-8 text-center">

        <!-- VÃ½bÄ›r kamery -->
        <select id="cameraSelect" class="form-select mb-2"></select>

        <!-- Video -->
        <video id="video" autoplay muted playsinline></video>

        <!-- OvlÃ¡dacÃ­ tlaÄÃ­tka -->
        <div class="mt-3">
          <button id="startBtn" class="btn btn-success me-2">Spustit skenovÃ¡nÃ­</button>
          <button id="stopBtn" class="btn btn-danger">Zastavit</button>
        </div>

        <div id="status" class="text-primary">PÅ™ipraven</div>

        <input id="result" class="form-control mt-3 text-center" placeholder="VÃ½sledek" readonly>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const { BrowserMultiFormatReader } = window.ZXingBrowser;
    const codeReader = new BrowserMultiFormatReader();
    let controls = null;

    const cameraSelect = document.getElementById('cameraSelect');
    const videoElem = document.getElementById('video');
    const statusElem = document.getElementById('status');
    const resultInput = document.getElementById('result');

    // Vyhledej vÅ¡echny zadnÃ­ kamery
    async function loadCameras() {
      try {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const backCameras = devices.filter(d => d.kind === 'videoinput' &&
          (d.label.toLowerCase().includes('back') || d.label.toLowerCase().includes('zadnÃ­')));

        if (backCameras.length === 0) {
          // fallback â€“ vÅ¡echny kamery
          backCameras.push(...devices.filter(d => d.kind === 'videoinput'));
        }

        cameraSelect.innerHTML = '';
        backCameras.forEach((cam, i) => {
          const opt = document.createElement('option');
          opt.value = cam.deviceId;
          opt.textContent = cam.label || `Kamera ${i+1}`;
          cameraSelect.appendChild(opt);
        });

        statusElem.textContent = `ğŸ“· Vyber kameru (zadnÃ­ pokud je k dispozici)`;
      } catch (err) {
        statusElem.textContent = `âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ kamer: ${err}`;
        console.error(err);
      }
    }

    async function startScan() {
      stopScan();
      resultInput.value = '';
      const deviceId = cameraSelect.value;

      try {
        controls = await codeReader.decodeFromConstraints(
          {
            video: {
              deviceId: deviceId ? { exact: deviceId } : undefined,
              width: { ideal: 1920 },
              height: { ideal: 1080 },
            }
          },
          videoElem,
          (result, err) => {
            if (result) {
              resultInput.value = result.getText();
              statusElem.textContent = "âœ… NaÄteno: " + result.getText();
              stopScan();
            }
          }
        );
        statusElem.textContent = `ğŸ“¡ SkenovÃ¡nÃ­ bÄ›Å¾Ã­ (kamera: ${cameraSelect.selectedOptions[0].text})`;
      } catch (err) {
        statusElem.textContent = `âŒ Chyba: ${err}`;
        console.error(err);
      }
    }

    function stopScan() {
